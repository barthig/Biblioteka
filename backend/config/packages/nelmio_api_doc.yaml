nelmio_api_doc:
  documentation:
    info:
      title: "Biblioteka API"
      description: "OpenAPI specification for the Biblioteka platform"
      version: "1.1.0"
    servers:
      - url: http://127.0.0.1:8000
        description: Lokalny serwer deweloperski
    components:
      securitySchemes:
        BearerAuth:
          type: http
          scheme: bearer
          bearerFormat: JWT
        ApiSecret:
          type: apiKey
          in: header
          name: X-API-SECRET
      schemas:
        Book:
          type: object
          properties:
            id:
              type: integer
              example: 1
            title:
              type: string
              example: Example title
            isbn:
              type: string
              nullable: true
              example: ISBN-00001
            publisher:
              type: string
              nullable: true
              example: Example Publisher
            publicationYear:
              type: integer
              nullable: true
              example: 2024
            resourceType:
              type: string
              nullable: true
              example: Printed
            signature:
              type: string
              nullable: true
              example: SIG-001-01
            description:
              type: string
              nullable: true
              example: Short description
            copies:
              type: integer
              example: 2
            totalCopies:
              type: integer
              example: 5
            storageCopies:
              type: integer
              example: 1
            openStackCopies:
              type: integer
              example: 1
            targetAgeGroup:
              type: string
              nullable: true
              example: 10-12
            targetAgeGroupLabel:
              type: string
              nullable: true
              example: 10-12 lat
            averageRating:
              type: number
              format: float
              nullable: true
              example: 4.5
            ratingCount:
              type: integer
              nullable: true
              example: 12
            createdAt:
              type: string
              format: date-time
            author:
              type: object
              properties:
                id:
                  type: integer
                  example: 10
                name:
                  type: string
                  example: Author Name
            categories:
              type: array
              items:
                type: object
                properties:
                  id:
                    type: integer
                    example: 3
                  name:
                    type: string
                    example: Fantasy
        Author:
          type: object
          properties:
            id:
              type: integer
              example: 10
            name:
              type: string
              example: Author Name
        Category:
          type: object
          properties:
            id:
              type: integer
              example: 3
            name:
              type: string
              example: Fantasy
        User:
          type: object
          properties:
            id:
              type: integer
              example: 284
            name:
              type: string
              example: Verified User
            email:
              type: string
              example: verified@example.com
            roles:
              type: array
              items:
                type: string
              example: [ROLE_USER]
            verified:
              type: boolean
              example: true
            blocked:
              type: boolean
              example: false
        Loan:
          type: object
          properties:
            id:
              type: integer
              example: 120
            book:
              $ref: '#/components/schemas/Book'
            bookCopyId:
              type: integer
              example: 501
            user:
              $ref: '#/components/schemas/User'
            borrowedAt:
              type: string
              format: date-time
            dueAt:
              type: string
              format: date-time
            returnedAt:
              type: string
              format: date-time
              nullable: true
            extensionsCount:
              type: integer
              example: 1
        Reservation:
          type: object
          properties:
            id:
              type: integer
              example: 45
            book:
              $ref: '#/components/schemas/Book'
            user:
              $ref: '#/components/schemas/User'
            status:
              type: string
              example: active
            reservedAt:
              type: string
              format: date-time
            expiresAt:
              type: string
              format: date-time
              nullable: true
            fulfilledAt:
              type: string
              format: date-time
              nullable: true
        Fine:
          type: object
          properties:
            id:
              type: integer
              example: 77
            amount:
              type: string
              example: "15.00"
            currency:
              type: string
              example: PLN
            reason:
              type: string
              example: Overdue
            paidAt:
              type: string
              format: date-time
              nullable: true
        Announcement:
          type: object
          properties:
            id:
              type: integer
              example: 12
            title:
              type: string
              example: New announcement
            content:
              type: string
              example: Content body
            type:
              type: string
              example: info
            status:
              type: string
              example: published
            isPinned:
              type: boolean
              example: false
            showOnHomepage:
              type: boolean
              example: true
            targetAudience:
              type: array
              items:
                type: string
              example: [all]
            expiresAt:
              type: string
              format: date-time
              nullable: true
        PaginationMeta:
          type: object
          properties:
            page:
              type: integer
              example: 1
            limit:
              type: integer
              example: 20
            total:
              type: integer
              example: 120
            totalPages:
              type: integer
              example: 6
        ListResponse:
          type: object
          properties:
            data:
              type: array
              items:
                type: object
            meta:
              $ref: '#/components/schemas/PaginationMeta'
        ItemResponse:
          type: object
          properties:
            data:
              type: object
        MessageResponse:
          type: object
          properties:
            message:
              type: string
              example: OK
        ErrorResponse:
          type: object
          required:
            - error
          properties:
            error:
              type: object
              required:
                - code
                - message
                - statusCode
              properties:
                code:
                  type: string
                  description: "Machine-readable error code (e.g., NOT_FOUND, BAD_REQUEST, VALIDATION_FAILED)"
                  example: NOT_FOUND
                  enum:
                    - BAD_REQUEST
                    - UNAUTHORIZED
                    - FORBIDDEN
                    - NOT_FOUND
                    - CONFLICT
                    - VALIDATION_FAILED
                    - UNPROCESSABLE_ENTITY
                    - LOCKED
                    - RATE_LIMIT_EXCEEDED
                    - INTERNAL_ERROR
                    - SERVICE_UNAVAILABLE
                message:
                  type: string
                  description: "Human-readable error message"
                  example: "User not found"
                statusCode:
                  type: integer
                  description: "HTTP status code"
                  example: 404
                details:
                  type: object
                  description: "Optional additional error details (validation errors, nested info, etc.)"
                  nullable: true
                  example: null
        ValidationErrorResponse:
          type: object
          required:
            - error
          properties:
            error:
              type: object
              required:
                - code
                - message
                - statusCode
                - details
              properties:
                code:
                  type: string
                  description: "Machine-readable error code for validation failures"
                  example: VALIDATION_FAILED
                  enum:
                    - VALIDATION_FAILED
                message:
                  type: string
                  description: "Standard validation failed message"
                  example: "Validation failed"
                statusCode:
                  type: integer
                  description: "HTTP status code for validation errors"
                  example: 400
                details:
                  type: object
                  description: "Field-specific validation error messages"
                  example:
                    email: "This value is not a valid email"
                    password: "This value is too short. It should have 8 characters or more"
    security:
      - BearerAuth: []
      - ApiSecret: []
  areas:
    default:
      path_patterns:
        - ^/api(?!/docs)
      documentation:
        tags:
          - name: Autoryzacja
            description: Logowanie i odnawianie sesji
          - name: Książki
            description: Operacje na katalogu książek i egzemplarzach
          - name: Wypożyczenia
            description: Zarządzanie wypożyczeniami oraz zwrotami
          - name: Rezerwacje
            description: Obsługa kolejki rezerwacji oraz powiadomień
          - name: Kary
            description: Naliczone kary finansowe i płatności
